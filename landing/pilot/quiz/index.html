<!doctype html>
<html lang="en">
  <head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-V2474V50XP"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag("js", new Date());
      gtag("config", "G-V2474V50XP");
    </script>

    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"
      referrerpolicy="no-referrer"
    />

    <title>Canopy Microclimate Readiness Quiz | HermodLabs</title>
    <meta
      name="description"
      content="Answer 15 questions to score your canopy microclimate readiness, get 3 insights, and receive next steps tailored to your situation."
    />

    <script type="importmap">
    {
      "imports": {
        "lit": "https://esm.run/lit"
      }
    }
    </script>

    <link rel="stylesheet" href="" id="main-css" />
    <script type="module" src="../../../bootstrap.js"></script>

    <style>
      /* Page-local styles (safe, scoped) */

      .quiz-wrap { margin-top: 0.5rem; }

      .quiz-header__kicker {
        font-size: 0.8rem;
        letter-spacing: 0.06em;
        text-transform: uppercase;
        color: rgba(0,0,0,0.55);
        margin: 0 0 0.35rem;
      }

      .quiz-header__title {
        margin: 0 0 0.5rem;
        font-size: 1.6rem;
        line-height: 2.0rem;
        letter-spacing: -0.03em;
      }

      .quiz-header__sub {
        margin: 0;
        font-size: 1rem;
        line-height: 1.55rem;
        color: rgba(0,0,0,0.72);
      }

      .quiz-progress {
        display: flex;
        gap: 0.6rem;
        align-items: center;
        margin: 1rem 0 0.25rem;
        flex-wrap: wrap;
      }

      .quiz-progress__step {
        display: inline-flex;
        gap: 0.5rem;
        align-items: center;
        padding: 0.35rem 0.55rem;
        border: 1px solid rgba(0,0,0,0.10);
        border-radius: 999px;
        background: #fff;
        color: rgba(0,0,0,0.72);
        font-size: 0.9rem;
        line-height: 1.1rem;
      }

      .quiz-progress__dot {
        width: 10px;
        height: 10px;
        border-radius: 999px;
        background: rgba(0,0,0,0.20);
      }

      .quiz-progress__step.is-active {
        border-color: rgba(0,0,0,0.22);
        color: rgba(0,0,0,0.9);
      }
      .quiz-progress__step.is-active .quiz-progress__dot { background: rgba(0,0,0,0.75); }

      .quiz-card {
        border: 1px solid rgba(0,0,0,0.10);
        border-radius: 16px;
        background: #fff;
        box-shadow: 0 1px 0 rgba(0,0,0,0.04);
        padding: 1rem;
      }

      .quiz-grid {
        display: grid;
        grid-template-columns: 1fr;
        gap: 1rem;
        margin-top: 1rem;
      }

      .quiz-grid--two {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 1rem;
      }

      .quiz-section__title {
        margin: 0 0 0.35rem;
        font-size: 1.05rem;
        line-height: 1.4rem;
        letter-spacing: -0.01em;
      }

      .quiz-section__text {
        margin: 0;
        font-size: 0.92rem;
        line-height: 1.45rem;
        color: rgba(0,0,0,0.72);
      }

      .quiz-field { display: grid; gap: 0.35rem; margin-top: 0.85rem; }
      .quiz-label {
        font-size: 0.9rem;
        line-height: 1.2rem;
        color: rgba(0,0,0,0.82);
      }

      .quiz-input,
      .quiz-select,
      .quiz-textarea {
        width: 100%;
        border: 1px solid rgba(0,0,0,0.14);
        border-radius: 12px;
        padding: 0.7rem 0.75rem;
        font-size: 0.95rem;
        line-height: 1.3rem;
        background: #fff;
        color: rgba(0,0,0,0.92);
        outline: none;
      }

      .quiz-textarea { resize: vertical; min-height: 110px; }

      .quiz-fineprint {
        margin: 0.75rem 0 0;
        font-size: 0.85rem;
        line-height: 1.25rem;
        color: rgba(0,0,0,0.60);
      }

      .quiz-step { display: none; }
      .quiz-step.is-active { display: block; }

      .quiz-q {
        border: 1px solid rgba(0,0,0,0.10);
        border-radius: 16px;
        background: #fff;
        padding: 0.9rem 0.95rem;
        box-shadow: 0 1px 0 rgba(0,0,0,0.04);
      }

      .quiz-q legend {
        font-size: 0.95rem;
        line-height: 1.35rem;
        letter-spacing: -0.01em;
        color: rgba(0,0,0,0.92);
        margin-bottom: 0.55rem;
        padding: 0;
      }

      .quiz-q__choices {
        display: flex;
        gap: 0.75rem;
        align-items: center;
        flex-wrap: wrap;
      }

      .quiz-choice {
        display: inline-flex;
        gap: 0.5rem;
        align-items: center;
        padding: 0.45rem 0.65rem;
        border: 1px solid rgba(0,0,0,0.10);
        border-radius: 999px;
        background: #fff;
        cursor: pointer;
        user-select: none;
      }

      .quiz-choice input { margin: 0; }

      .quiz-actions {
        display: flex;
        gap: 0.6rem;
        align-items: center;
        margin-top: 1rem;
        flex-wrap: wrap;
      }

      /* Results */
      .results-grid {
        display: grid;
        grid-template-columns: 1fr 0.95fr;
        gap: 1rem;
        align-items: start;
        margin-top: 1rem;
      }

      .gauge {
        --p: 0; /* 0..100 */
        width: 260px;
        height: 130px;
        border-radius: 260px 260px 0 0;
        background:
          conic-gradient(
            from 180deg,
            rgba(0,0,0,0.75) 0deg calc(var(--p) * 1.8deg),
            rgba(0,0,0,0.12) 0deg 180deg,
            transparent 0deg
          );
        position: relative;
        overflow: hidden;
        margin: 0.25rem 0 0.75rem;
      }

      .gauge::after {
        content: "";
        position: absolute;
        inset: 14px;
        border-radius: 999px 999px 0 0;
        background: #fff;
      }

      .gauge__center {
        position: absolute;
        left: 0;
        right: 0;
        bottom: 8px;
        text-align: center;
        z-index: 2;
      }

      .gauge__percent {
        font-size: 1.6rem;
        letter-spacing: -0.03em;
        margin: 0;
        color: rgba(0,0,0,0.92);
      }

      .gauge__label {
        margin: 0.1rem 0 0;
        font-size: 0.9rem;
        color: rgba(0,0,0,0.65);
      }

      .results-badge {
        display: inline-flex;
        gap: 0.5rem;
        align-items: center;
        padding: 0.35rem 0.6rem;
        border-radius: 999px;
        border: 1px solid rgba(0,0,0,0.12);
        background: #fff;
        font-size: 0.9rem;
        color: rgba(0,0,0,0.78);
      }

      .results-badge__dot {
        width: 10px;
        height: 10px;
        border-radius: 999px;
        background: rgba(0,0,0,0.30);
      }

      .results-list {
        margin: 0.5rem 0 0;
        padding-left: 1.05rem;
        color: rgba(0,0,0,0.72);
        font-size: 0.92rem;
        line-height: 1.45rem;
      }

      .results-next {
        display: grid;
        gap: 0.75rem;
        margin-top: 0.9rem;
      }

      .results-cta {
        border: 1px solid rgba(0,0,0,0.10);
        border-radius: 16px;
        background: #fff;
        box-shadow: 0 1px 0 rgba(0,0,0,0.04);
        padding: 0.95rem 1rem;
      }

      .results-cta__title {
        margin: 0 0 0.25rem;
        font-size: 1rem;
        letter-spacing: -0.01em;
      }

      .results-cta__text {
        margin: 0;
        font-size: 0.92rem;
        line-height: 1.45rem;
        color: rgba(0,0,0,0.72);
      }

      .results-footer {
        margin-top: 1rem;
        border-top: 1px solid rgba(0,0,0,0.10);
        padding-top: 0.9rem;
        font-size: 0.9rem;
        color: rgba(0,0,0,0.70);
      }

      .status-line {
        margin: 0.75rem 0 0;
        font-size: 0.9rem;
        color: rgba(0,0,0,0.70);
      }

      /* Mobile */
      @media (max-width: 980px) {
        .quiz-grid--two { grid-template-columns: 1fr; }
        .results-grid { grid-template-columns: 1fr; }
        .gauge { width: 240px; height: 120px; border-radius: 240px 240px 0 0; }
      }
    </style>
  </head>

  <body>
    <site-page>
      <section class="priority-access" aria-labelledby="quiz-title">
        <div class="priority-access__inner quiz-wrap">

          <header class="priority-access__header quiz-header">
            <p class="quiz-header__kicker">Canopy Microclimate Readiness</p>
            <h1 class="quiz-header__title" id="quiz-title">15-Question Assessment</h1>
            <p class="quiz-header__sub">
              Part 1: contact info • Part 2: how you diagnose + verify • Part 3: dynamic results with next steps.
            </p>

            <div class="quiz-progress" aria-label="Assessment progress">
              <div class="quiz-progress__step is-active" data-step-indicator="1">
                <span class="quiz-progress__dot" aria-hidden="true"></span>
                <span>Part 1: Contact</span>
              </div>
              <div class="quiz-progress__step" data-step-indicator="2">
                <span class="quiz-progress__dot" aria-hidden="true"></span>
                <span>Part 2: Questions</span>
              </div>
              <div class="quiz-progress__step" data-step-indicator="3">
                <span class="quiz-progress__dot" aria-hidden="true"></span>
                <span>Part 3: Results</span>
              </div>
            </div>
          </header>

          <form id="canopy-assessment-form" novalidate>
            <!-- simple spam trap -->
            <input type="hidden" name="_gotcha" id="form-gotcha" value="" />

            <!-- STEP 1: Lead info -->
            <section class="quiz-step is-active" data-step="1" aria-label="Part 1: Contact information">
              <div class="quiz-grid">
                <div class="quiz-card">
                  <h2 class="quiz-section__title">Part 1 — Tell us where to send your results</h2>
                  <p class="quiz-section__text">
                    Name and email are required. Phone is optional (helpful if you want a fast follow-up).
                  </p>

                  <div class="quiz-grid quiz-grid--two">
                    <div class="quiz-field">
                      <label class="quiz-label" for="name">Name <span aria-hidden="true">*</span></label>
                      <input class="quiz-input" id="name" name="name" type="text" autocomplete="name" required />
                    </div>

                    <div class="quiz-field">
                      <label class="quiz-label" for="email">Email <span aria-hidden="true">*</span></label>
                      <input class="quiz-input" id="email" name="email" type="email" autocomplete="email" required />
                    </div>

                    <div class="quiz-field">
                      <label class="quiz-label" for="phone">Phone (optional)</label>
                      <input class="quiz-input" id="phone" name="phone" type="tel" autocomplete="tel" placeholder="+1 (555) 555-5555" />
                    </div>
                  </div>

                  <p class="quiz-fineprint">
                    We’ll only use this to send your results and follow up if you request it. No spam.
                  </p>

                  <div class="quiz-actions">
                    <button class="button button--primary" type="button" id="btn-to-step-2">
                      Continue to questions
                    </button>
                  </div>
                </div>
              </div>
            </section>

            <!-- STEP 2: Questions -->
            <section class="quiz-step" data-step="2" aria-label="Part 2: Questions">
              <div class="quiz-grid">
                <div class="quiz-card">
                  <h2 class="quiz-section__title">Part 2 — How easy is it to prove what’s happening? (10 questions)</h2>
                  <p class="quiz-section__text">
                    Answer Yes/No. This checks whether you can pinpoint problem pockets and confirm fixes without relying on guesses.
                  </p>

                  <div class="quiz-grid" style="margin-top: 0.9rem;">
                    <fieldset class="quiz-q">
                      <legend>1) When there’s a problem, can you describe it precisely (where, when, how long, what growth stage) instead of “the room feels off”?</legend>
                      <div class="quiz-q__choices">
                        <label class="quiz-choice"><input type="radio" name="dsm1" value="yes" required /> Yes</label>
                        <label class="quiz-choice"><input type="radio" name="dsm1" value="no" required /> No</label>
                      </div>
                    </fieldset>

                    <fieldset class="quiz-q">
                      <legend>2) Do you measure conditions where the plants are (canopy level / multiple spots), not just on a wall sensor?</legend>
                      <div class="quiz-q__choices">
                        <label class="quiz-choice"><input type="radio" name="dsm2" value="yes" required /> Yes</label>
                        <label class="quiz-choice"><input type="radio" name="dsm2" value="no" required /> No</label>
                      </div>
                    </fieldset>

                    <fieldset class="quiz-q">
                      <legend>3) Can you line up data to the same moment each day (like “time since lights off” or “after irrigation”) so comparisons are fair?</legend>
                      <div class="quiz-q__choices">
                        <label class="quiz-choice"><input type="radio" name="dsm3" value="yes" required /> Yes</label>
                        <label class="quiz-choice"><input type="radio" name="dsm3" value="no" required /> No</label>
                      </div>
                    </fieldset>

                    <fieldset class="quiz-q">
                      <legend>4) Before comparing “before vs after,” do you check you’re comparing similar conditions (same stage, similar weather load, similar irrigation pattern)?</legend>
                      <div class="quiz-q__choices">
                        <label class="quiz-choice"><input type="radio" name="dsm4" value="yes" required /> Yes</label>
                        <label class="quiz-choice"><input type="radio" name="dsm4" value="no" required /> No</label>
                      </div>
                    </fieldset>

                    <fieldset class="quiz-q">
                      <legend>5) Do you track repeat issues by specific area (corner/rack/zone), so you can say what keeps coming back—and where?</legend>
                      <div class="quiz-q__choices">
                        <label class="quiz-choice"><input type="radio" name="dsm5" value="yes" required /> Yes</label>
                        <label class="quiz-choice"><input type="radio" name="dsm5" value="no" required /> No</label>
                      </div>
                    </fieldset>

                    <fieldset class="quiz-q">
                      <legend>6) If a sensor might be wrong, do you handle it with a quick check (or backup measurement) instead of getting stuck in arguments?</legend>
                      <div class="quiz-q__choices">
                        <label class="quiz-choice"><input type="radio" name="dsm6" value="yes" required /> Yes</label>
                        <label class="quiz-choice"><input type="radio" name="dsm6" value="no" required /> No</label>
                      </div>
                    </fieldset>

                    <fieldset class="quiz-q">
                      <legend>7) When you make changes, do you write down what you changed and what result you expect (so you can tell what actually worked)?</legend>
                      <div class="quiz-q__choices">
                        <label class="quiz-choice"><input type="radio" name="dsm7" value="yes" required /> Yes</label>
                        <label class="quiz-choice"><input type="radio" name="dsm7" value="no" required /> No</label>
                      </div>
                    </fieldset>

                    <fieldset class="quiz-q">
                      <legend>8) After changes, do you measure again to confirm the problem moved/cleared (instead of assuming it worked)?</legend>
                      <div class="quiz-q__choices">
                        <label class="quiz-choice"><input type="radio" name="dsm8" value="yes" required /> Yes</label>
                        <label class="quiz-choice"><input type="radio" name="dsm8" value="no" required /> No</label>
                      </div>
                    </fieldset>

                    <fieldset class="quiz-q">
                      <legend>9) Could you show someone your evidence two weeks later (notes + data + before/after) and have it still make sense?</legend>
                      <div class="quiz-q__choices">
                        <label class="quiz-choice"><input type="radio" name="dsm9" value="yes" required /> Yes</label>
                        <label class="quiz-choice"><input type="radio" name="dsm9" value="no" required /> No</label>
                      </div>
                    </fieldset>

                    <fieldset class="quiz-q">
                      <legend>10) If you don’t have enough evidence yet, is it acceptable to say “not sure yet” and take a clear next measurement step?</legend>
                      <div class="quiz-q__choices">
                        <label class="quiz-choice"><input type="radio" name="dsm10" value="yes" required /> Yes</label>
                        <label class="quiz-choice"><input type="radio" name="dsm10" value="no" required /> No</label>
                      </div>
                    </fieldset>
                  </div>
                </div>

                <div class="quiz-card">
                  <h2 class="quiz-section__title">Qualification (5 questions)</h2>
                  <p class="quiz-section__text">
                    These help tailor your results and recommend the best next step.
                  </p>

                  <div class="quiz-field">
                    <label class="quiz-label" for="role">11) What best describes your role? <span aria-hidden="true">*</span></label>
                    <select class="quiz-select" id="role" name="role" required>
                      <option value="" selected disabled>Select one…</option>
                      <option value="owner_operator">Owner / Operator</option>
                      <option value="head_grower">Head Grower / Cultivation Lead</option>
                      <option value="facilities_hvac">Facilities / HVAC / Engineering</option>
                      <option value="ops_gm">Operations / GM</option>
                      <option value="consultant_integrator">Consultant / Integrator</option>
                      <option value="other">Other</option>
                    </select>
                  </div>

                  <div class="quiz-field">
                    <label class="quiz-label" for="outcome">12) What outcome matters most in the next 90 days? <span aria-hidden="true">*</span></label>
                    <select class="quiz-select" id="outcome" name="outcome" required>
                      <option value="" selected disabled>Select one…</option>
                      <option value="stop_repeat_problem">Stop a repeat pocket / recurring corner problem</option>
                      <option value="prove_fix_holds">Prove a fix holds (defensible before/after)</option>
                      <option value="handoff_confidence">Cross-shift / cross-team handoff confidence</option>
                      <option value="reduce_theater">Reduce meeting arguments (“dashboard says green”)</option>
                      <option value="audit_ready">Be audit/QA ready (traceable notes + evidence)</option>
                      <option value="other">Other</option>
                    </select>
                  </div>

                  <div class="quiz-field">
                    <label class="quiz-label" for="obstacle">13) What’s the biggest friction today? <span aria-hidden="true">*</span></label>
                    <select class="quiz-select" id="obstacle" name="obstacle" required>
                      <option value="" selected disabled>Select one…</option>
                      <option value="avg_wash">Averages hide pockets (can’t “prove where”)</option>
                      <option value="no_compare">Hard to compare runs honestly (stage/season drift)</option>
                      <option value="sensor_dispute">Sensor distrust causes decision paralysis</option>
                      <option value="changes_cluster">We change too many things at once (no learning)</option>
                      <option value="no_verify">We don’t re-check after changes</option>
                      <option value="other">Other</option>
                    </select>
                  </div>

                  <div class="quiz-field">
                    <label class="quiz-label" for="solution">14) Which next step fits you best? <span aria-hidden="true">*</span></label>
                    <select class="quiz-select" id="solution" name="solution" required>
                      <option value="" selected disabled>Select one…</option>
                      <option value="pilot_pocket_scan">Quick pocket check (fast diagnosis)</option>
                      <option value="pilot_zone_map">Full room “zone map” (spatial proof)</option>
                      <option value="pilot_baseline_verify">Before/after proof loop (baseline + re-check)</option>
                      <option value="pilot_drift_control">Ongoing drift watch (keep it fixed)</option>
                      <option value="training_only">Training / SOPs only</option>
                    </select>
                  </div>

                  <div class="quiz-field">
                    <label class="quiz-label" for="notes">15) Anything else we should know? (optional)</label>
                    <textarea
                      class="quiz-textarea"
                      id="notes"
                      name="notes"
                      placeholder="Rooms, repeat corner, trigger (lights-off/irrigation), constraints, timeline, who has to sign off, etc."
                    ></textarea>
                  </div>

                  <div class="quiz-actions">
                    <button class="button button--secondary" type="button" id="btn-back-to-step-1">
                      Back
                    </button>
                    <button class="button button--primary" type="button" id="btn-submit">
                      See my results
                    </button>
                  </div>

                  <p class="status-line" id="save-status" aria-live="polite"></p>
                </div>
              </div>
            </section>

            <!-- STEP 3: Results -->
            <section class="quiz-step" data-step="3" aria-label="Part 3: Results">
              <div class="quiz-grid">
                <div class="quiz-card">
                  <h2 class="quiz-section__title">Part 3 — Your Dynamic Results</h2>
                  <p class="quiz-section__text">
                    This is tailored to your answers. Your score is based on the 10 “prove it / verify it” questions.
                  </p>

                  <div class="results-grid">
                    <!-- Big reveal -->
                    <div class="quiz-card" style="padding: 1rem;">
                      <div class="results-badge" id="results-badge" aria-label="Overall readiness level">
                        <span class="results-badge__dot" aria-hidden="true"></span>
                        <span id="results-level">—</span>
                      </div>

                      <div class="gauge" id="gauge" style="--p: 0;">
                        <div class="gauge__center">
                          <p class="gauge__percent" id="results-percent">0%</p>
                          <p class="gauge__label" id="results-headline">—</p>
                        </div>
                      </div>

                      <p class="quiz-section__text" id="results-summary" style="margin-top: 0.25rem;">
                        —
                      </p>
                    </div>

                    <!-- Insights + next steps -->
                    <div class="quiz-card" style="padding: 1rem;">
                      <h3 class="quiz-section__title" style="font-size: 1rem;">3 insights</h3>
                      <ol class="results-list" id="insights-list">
                        <li>—</li>
                      </ol>

                      <div class="results-next" id="next-steps"></div>

                      <div class="results-footer">
                        <strong>Contact</strong><br />
                        Email: <span style="opacity:0.9;">hello@hermodlabs.com</span><br />
                        Or: <a href="/engage/pilot">Explore pilots</a> • <a href="/explore/events#rsvp">Live walkthrough</a>
                      </div>
                    </div>
                  </div>

                  <div class="quiz-actions">
                    <button class="button button--secondary" type="button" id="btn-edit">
                      Edit my answers
                    </button>
                    <a class="button button--primary" href="/engage/pilot">
                      Explore pilots
                    </a>
                  </div>

                  <p class="status-line" id="results-save-status" aria-live="polite"></p>
                </div>
              </div>
            </section>
          </form>
        </div>
      </section>
    </site-page>

    <script>
      (function () {
        // Update this if you use a different endpoint for the quiz:
        const GETFORM_ENDPOINT = "https://getform.io/f/avrzylpa";

        const form = document.getElementById("canopy-assessment-form");

        const btnToStep2 = document.getElementById("btn-to-step-2");
        const btnBackToStep1 = document.getElementById("btn-back-to-step-1");
        const btnSubmit = document.getElementById("btn-submit");
        const btnEdit = document.getElementById("btn-edit");

        const saveStatus = document.getElementById("save-status");
        const resultsSaveStatus = document.getElementById("results-save-status");

        const stepEls = Array.from(document.querySelectorAll(".quiz-step"));
        const stepIndicators = Array.from(document.querySelectorAll("[data-step-indicator]"));

        // Results elements
        const gaugeEl = document.getElementById("gauge");
        const resultsPercentEl = document.getElementById("results-percent");
        const resultsLevelEl = document.getElementById("results-level");
        const resultsHeadlineEl = document.getElementById("results-headline");
        const resultsSummaryEl = document.getElementById("results-summary");
        const insightsListEl = document.getElementById("insights-list");
        const nextStepsEl = document.getElementById("next-steps");

        // Helpers
        function setStep(stepNum) {
          stepEls.forEach(el => el.classList.toggle("is-active", el.getAttribute("data-step") === String(stepNum)));
          stepIndicators.forEach(ind => ind.classList.toggle("is-active", ind.getAttribute("data-step-indicator") === String(stepNum)));
          window.scrollTo({ top: 0, behavior: "smooth" });
        }

        function setText(el, text) {
          if (!el) return;
          el.textContent = text;
        }

        function firstInvalidIn(container) {
          const invalid = container.querySelector(":invalid");
          return invalid || null;
        }

        function validateStep(stepNum) {
          const stepEl = stepEls.find(el => el.getAttribute("data-step") === String(stepNum));
          if (!stepEl) return true;

          const invalid = firstInvalidIn(stepEl);
          if (invalid) {
            invalid.focus({ preventScroll: true });
            invalid.reportValidity();
            return false;
          }
          return true;
        }

        function readFormValue(name) {
          const field = form.querySelector(`[name="${name}"]`);
          if (!field) return "";
          if (field.type === "radio") {
            const checked = form.querySelector(`[name="${name}"]:checked`);
            return checked ? checked.value : "";
          }
          return field.value || "";
        }

        function computeScore() {
          let yesCount = 0;
          const dsm = {};
          for (let i = 1; i <= 10; i++) {
            const key = "dsm" + i;
            const v = readFormValue(key);
            dsm[key] = v;
            if (v === "yes") yesCount += 1;
          }
          const percent = Math.round((yesCount / 10) * 100);

          let level = "Some structure";
          if (percent >= 80) level = "Evidence-ready";
          else if (percent < 50) level = "Hard to prove";

          return { yesCount, percent, level, dsm };
        }

        const dsmRecommendations = {
          dsm1: "Use a simple problem statement: where, when, how long, and what growth stage. It prevents the issue from turning vague.",
          dsm2: "Measure where the plants are (multiple spots). Wall averages won’t catch pockets.",
          dsm3: "Line up data to the same moment (like time since lights-off). Otherwise “before/after” gets misleading.",
          dsm4: "Use a quick “are these comparable?” check (stage, irrigation pattern, outside load).",
          dsm5: "Track repeats by area so you can target the real source, not the room average.",
          dsm6: "Have a fast way to handle sensor doubt (spot check / backup reading) so you don’t stall decisions.",
          dsm7: "Write down the change + expected effect so you can learn what actually worked.",
          dsm8: "Always re-measure after changes. If you don’t re-check, you don’t know.",
          dsm9: "Keep a simple record: what happened, what you measured, what changed, and what improved.",
          dsm10:"Allow “not enough proof yet” and take the next measurement step instead of forcing a confident answer."
        };

        function readQualifiers() {
          return {
            role: readFormValue("role"),
            outcome: readFormValue("outcome"),
            obstacle: readFormValue("obstacle"),
            solution: readFormValue("solution"),
            notes: readFormValue("notes")
          };
        }

        function buildInsights(score, qualifiers) {
          const { level, dsm } = score;
          const insights = [];

          if (level === "Evidence-ready") {
            insights.push("You’re set up to pinpoint problems and confirm fixes. That means fewer debates and faster learning.");
          } else if (level === "Some structure") {
            insights.push("You have a good base, but a few missing steps can let pockets survive transitions and meetings.");
          } else {
            insights.push("Right now it’s easy to get stuck in debate: without clear definitions and re-checks, problems tend to repeat.");
          }

          const missed = [];
          for (let i = 1; i <= 10; i++) {
            const key = "dsm" + i;
            if (dsm[key] === "no") missed.push(key);
          }
          if (missed.length > 0) {
            const topTwo = missed.slice(0, 2).map(k => dsmRecommendations[k]).filter(Boolean);
            if (topTwo.length) insights.push("Highest-impact improvements: " + topTwo.join(" "));
          } else {
            insights.push("You answered “Yes” to everything. If issues still repeat, the cause is usually hidden pockets or shifting conditions you haven’t mapped yet.");
          }

          if (qualifiers.obstacle === "avg_wash") {
            insights.push("You called it: averages hide pockets. A zone-level view is usually the fastest way to make the issue undeniable and fixable.");
          } else if (qualifiers.obstacle === "no_compare") {
            insights.push("If runs aren’t comparable, “before/after” claims get shaky. Align to events (lights-off/irrigation) and use a quick comparability check.");
          } else if (qualifiers.obstacle === "sensor_dispute") {
            insights.push("If sensors are a constant argument, use quick checks and backup readings so one device can’t stall action.");
          } else if (qualifiers.obstacle === "changes_cluster") {
            insights.push("If you change lots of things at once, you lose learning. Make one targeted change and re-measure.");
          } else if (qualifiers.obstacle === "no_verify") {
            insights.push("If you don’t re-check after changes, you can’t know it worked. A simple verification pass eliminates false closure.");
          } else {
            insights.push("Your answers suggest the biggest win is turning “felt” problems into measurable, repeatable evidence.");
          }

          return insights.slice(0, 3);
        }

        function buildNextSteps(score, qualifiers) {
          const { level } = score;
          const solution = qualifiers.solution;
          const obstacle = qualifiers.obstacle;
          const outcome = qualifiers.outcome;

          let title = "Recommended next step";
          let text = "";
          let primary = { label: "Explore pilots", href: "/engage/pilot" };
          let secondary = { label: "Live walkthrough", href: "/explore/events#rsvp" };

          if (solution === "pilot_pocket_scan") {
            title = "Quick pocket check (fast diagnosis)";
            text = "Best when you suspect a problem corner but can’t prove it yet. We help you pin it down with real measurements and a clear plan.";
            primary = { label: "Explore this option", href: "/engage/pilot" };
          } else if (solution === "pilot_zone_map") {
            title = "Full room zone map (spatial proof)";
            text = "Best when averages look fine but pockets keep biting you. A zone map makes problem areas visible and testable.";
            primary = { label: "Explore this option", href: "/engage/pilot" };
          } else if (solution === "pilot_baseline_verify") {
            title = "Before/after proof loop (baseline + re-check)";
            text = "Best when you need defensible proof that a change worked. Measure → change → measure again, under comparable conditions.";
            primary = { label: "Explore this option", href: "/engage/pilot" };
          } else if (solution === "pilot_drift_control") {
            title = "Ongoing drift watch (keep it fixed)";
            text = "Best when you’ve solved problems once and want to keep them solved. Regular check-ins and drift detection prevent backsliding.";
            primary = { label: "Explore this option", href: "/engage/pilot" };
          } else if (solution === "training_only") {
            title = "Training / SOPs only";
            text = "Best if your bottleneck is consistency across people and shifts. We help your team adopt a repeatable diagnose-and-verify routine.";
            primary = { label: "See a walkthrough", href: "/explore/events#rsvp" };
            secondary = { label: "Explore pilots", href: "/engage/pilot" };
          } else {
            if (level === "Hard to prove") {
              title = "Start with a quick pocket check";
              text = "The biggest jump comes from measuring where the plants are and re-checking after changes. That turns arguments into learning.";
              primary = { label: "Explore options", href: "/engage/pilot" };
            } else if (obstacle === "avg_wash") {
              title = "Consider a full zone map";
              text = "If averages are beating you in meetings, spatial proof is the fastest way to win time back and target fixes.";
              primary = { label: "Explore options", href: "/engage/pilot" };
            } else if (outcome === "prove_fix_holds" || obstacle === "no_verify" || obstacle === "changes_cluster") {
              title = "Do a before/after proof loop";
              text = "If you need proof a fix holds, the simplest path is: baseline measurement → targeted change → re-measure under similar conditions.";
              primary = { label: "Explore options", href: "/engage/pilot" };
            } else {
              title = "Choose the simplest repeatable next step";
              text = "Pick a next step you can repeat: pinpoint a problem area, line up to the same moment, make one change, and re-check.";
              primary = { label: "Explore pilots", href: "/engage/pilot" };
              secondary = { label: "Live walkthrough", href: "/explore/events#rsvp" };
            }
          }

          return `
            <div class="results-cta">
              <h4 class="results-cta__title">${title}</h4>
              <p class="results-cta__text">${text}</p>
              <div class="quiz-actions" style="margin-top:0.75rem;">
                <a class="button button--primary" href="${primary.href}">${primary.label}</a>
                <a class="button button--secondary" href="${secondary.href}">${secondary.label}</a>
              </div>
            </div>
          `;
        }

        async function sendToGetform(payload) {
          const gotcha = document.getElementById("form-gotcha");
          if (gotcha && gotcha.value) return { ok: true, skipped: true };

          try {
            const res = await fetch(GETFORM_ENDPOINT, {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
                "Accept": "application/json"
              },
              body: JSON.stringify(payload)
            });

            return { ok: res.ok, status: res.status };
          } catch (e) {
            return { ok: false, error: String(e) };
          }
        }

        function renderResults(score, qualifiers) {
          gaugeEl.style.setProperty("--p", String(score.percent));
          setText(resultsPercentEl, `${score.percent}%`);

          setText(resultsLevelEl, `${score.level}`);
          if (score.level === "Evidence-ready") {
            setText(resultsHeadlineEl, "You can prove what’s happening");
            setText(resultsSummaryEl, "You’re set up to pinpoint problems, compare fairly, and confirm fixes. Remaining risk is usually hidden pockets or shifting conditions.");
          } else if (score.level === "Some structure") {
            setText(resultsHeadlineEl, "Good base, a few missing steps");
            setText(resultsSummaryEl, "You have parts of a repeatable process, but gaps can let problems survive transitions and meetings.");
          } else {
            setText(resultsHeadlineEl, "Easy to get stuck in debate");
            setText(resultsSummaryEl, "Without clear definitions, fair comparisons, and re-checks after changes, problems tend to repeat and decisions default to averages or opinions.");
          }

          const insights = buildInsights(score, qualifiers);
          insightsListEl.innerHTML = insights.map(s => `<li>${s}</li>`).join("");

          nextStepsEl.innerHTML = buildNextSteps(score, qualifiers);
        }

        function collectPayload(score) {
          return {
            assessment: "Canopy Microclimate Readiness (prove + verify)",
            name: readFormValue("name"),
            email: readFormValue("email"),
            phone: readFormValue("phone"),

            // “Prove it / verify it” questions
            prove_verify: score.dsm,
            prove_verify_yes_count: score.yesCount,
            readiness_percent: score.percent,
            readiness_level: score.level,

            // Qualifiers
            role: readFormValue("role"),
            outcome_90d: readFormValue("outcome"),
            obstacle: readFormValue("obstacle"),
            preferred_solution: readFormValue("solution"),
            notes: readFormValue("notes"),

            submitted_at: new Date().toISOString(),
            user_agent: navigator.userAgent
          };
        }

        // Button handlers
        btnToStep2.addEventListener("click", function () {
          const ok = validateStep(1);
          if (!ok) return;

          try { gtag("event", "assessment_step_complete", { step: 1 }); } catch (e) {}
          setStep(2);
        });

        btnBackToStep1.addEventListener("click", function () {
          setStep(1);
        });

        btnSubmit.addEventListener("click", async function () {
          const ok = validateStep(2);
          if (!ok) return;

          const score = computeScore();
          const qualifiers = readQualifiers();

          renderResults(score, qualifiers);
          setStep(3);

          try { gtag("event", "assessment_submitted", { score: score.percent, level: score.level }); } catch (e) {}

          const payload = collectPayload(score);

          setText(saveStatus, "Saving your answers…");
          setText(resultsSaveStatus, "Saving your answers…");

          const res = await sendToGetform(payload);

          if (res.ok) {
            setText(saveStatus, "Saved. Thank you — we’ll follow up with next steps if requested.");
            setText(resultsSaveStatus, "Saved. Thank you — we’ll follow up with next steps if requested.");
          } else {
            setText(saveStatus, "Couldn’t save automatically. Please try again or contact us directly.");
            setText(resultsSaveStatus, "Couldn’t save automatically. Please try again or contact us directly.");
          }
        });

        btnEdit.addEventListener("click", function () {
          setStep(2);
        });
      })();
    </script>
  </body>
</html>
